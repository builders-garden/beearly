generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  address       String
  created_at    DateTime? 
  updated_at    DateTime? 
}

model Waitlist {
  id              Int              @default(autoincrement()) @unique
  name            String           @db.VarChar
  slug            String            @unique
  externalUrl     String            @map("external_url")  
  endDate         DateTime          @map("end_date")
  imageLanding    String            @map("image_landing")
  imageSuccess    String            @map("image_success")
  imageNotEligible String          @map("image_not_eligible")
  imageError      String            @map("image_error")
  userAddress     String            @map("user_address")
  createdAt       DateTime          @map("created_at")
  updatedAt       DateTime          @map("updated_at")
  waitlistedUsers WaitlistedUser[]
  waitlistRequirements WaitlistRequirement[]
  waitlistMessages WaitlistMessages[]
}

model WaitlistedUser {
  id            Int        @default(autoincrement())
  waitlistId    Int        @map("waitlist_id")
  fid           Int
  address       String
  displayName   String     @db.VarChar @map("display_name")
  username      String     @db.VarChar
  avatarUrl     String?    @map("avatar_url")
  powerBadge    Boolean?   @default(false) @map("power_badge")
  referrerFid   Int?       @map("referrer_fid")
  waitlistedAt  DateTime   
  createdAt     DateTime   @map("created_at")
  updatedAt     DateTime   @map("updated_at")
  waitlist      Waitlist  @relation(fields: [waitlistId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  referrer      WaitlistedUser? @relation("Referrals", fields: [waitlistId, referrerFid], references: [waitlistId, fid])
  referrals    WaitlistedUser[] @relation("Referrals")

  @@index([waitlistId, fid], name: "waitlistId_fid")
  @@unique([waitlistId, fid], name: "waitlistId_fid")
}

enum WaitlistRequirementType {
  CHANNEL_FOLLOW
  USER_FOLLOW
  POWER_BADGE
}
model WaitlistRequirement {
  id            Int        @default(autoincrement()) @unique
  waitlistId    Int        @map("waitlist_id")
  value         String 
  type   WaitlistRequirementType     
  createdAt     DateTime   @map("created_at")
  updatedAt     DateTime   @map("updated_at")
  waitlist      Waitlist  @relation(fields: [waitlistId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model WaitlistMessages {
  id            Int        @default(autoincrement()) @unique
  waitlistId    Int        @map("waitlist_id")
  message       String
  createdAt     DateTime   @map("created_at")
  updatedAt     DateTime   @map("updated_at")
  waitlist      Waitlist  @relation(fields: [waitlistId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}